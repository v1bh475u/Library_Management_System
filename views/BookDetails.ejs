<!-- Book Details -->
<h1>
  <%= book.title %>
</h1>
<p>Author: <%= book.author %>
</p>
<p>Genre: <%= book.genre %>
</p>
<!--<% /* %> <p>Summary: <%= book.summary %>
</p> -->
<!-- <p>Pages: <%= book.pages %>
</p>
<p>Publisher: <%= book.publisher %>
</p>
<p>Published: <%= book.published %>
  <% */ %>
</p> -->


<% if (book.status==='available') { %>
<button onclick="checkoutBook('<%= book.id %>')">Checkout</button>
<% } else { %>
<% if (book.borrower === user.username) { %>
<button onclick="checkinBook('<%= book.id %>')">Checkin</button>
<% } else{ %>
<p>Borrowed by <%= book.borrower %>
</p>
<% }%>
<% } %>


<h2>Borrowing History</h2>
<ul>
  <%/*%> <% book.borrowingHistory.forEach(function(history) { %>
  <li>
    <p>Borrowed by <%= history.borrower %>
    </p>
    <p>Borrowed on <%= history.borrowedOn %></p>
    <% if (history.returnedOn) { %>
    <p>Returned on <%= history.returnedOn %>
    </p>
    <% } %>
  </li>
  <% }); %><%*/%>
</ul>


<script>
  function checkoutBook(bookId) {
    fetch('/checkout', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        bookId: bookId,
        borrower: '<%=user.username%>'
      })
    })
    window.location.href = `/books`;
  }

  function checkinBook(bookId) {
    fetch('/checkin', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        bookId: bookId,
        borrower: '<%= user.username %>'
      })
    })
    window.location.href = `/books`;
  }
</script>